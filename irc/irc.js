var counter=0;function HtmlEncode(a){var b=document.createElement("div");b.innerText=b.textContent=a;a=b.innerHTML;delete b;return a}function init(){setInterval(reload,1E3);localStorage.handle&&login()}function updateNumChars(){txt=document.getElementById("msg").value;numCharsRemaining=160-txt.length;document.getElementById("chars").innerHTML=numCharsRemaining}
function reload(){$.getJSON("http://messagehub.herokuapp.com/messages.json/",function(a){for(i=counter;i<a.length;i++)$("div#log").append('<p><span class="username">'+HtmlEncode(a[i].username)+'</span> <span class="datetime">'+a[i].created_at+'</span>: <span class="msg">'+HtmlEncode(a[i].content)+"</span></p>");counter=a.length})}
function store(){msg=document.getElementById("msg").value;postData={"message[username]":localStorage.handle,"message[content]":msg,"message[app_id]":5};$.post("http://messagehub.herokuapp.com/messages",postData);reload();document.getElementById("msg").value=""}
function login(){localStorage.handle||(h=document.getElementById("handle").value,localStorage.handle=h);try{document.getElementById("panel").innerHTML="<p>"+localStorage.handle+' &gt; <input type="text" id="msg" onchange="store()" onkeyup="updateNumChars()" size="60" maxlength="160" /> Characters remaining: <span id="chars">160</span></p>'}catch(a){}reload()};